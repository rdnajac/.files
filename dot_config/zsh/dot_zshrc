# .zshrc - my zsh configuration
setopt interactivecomments

[ -f "$HOME"/.bash_aliases ] && . "$HOME"/.bash_aliases

# Section: History {{{
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY SHARE_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_REDUCE_BLANKS

# see `/private/etc/zshrc` for defaults
# export HISTFILE="${ZDOTDIR:-$HOME}/.zsh_history"
# export HISTSIZE=10000
# export SAVEHIST=10000

# Don't pollute $HOME with history files
alias wget='wget --no-hsts'
export LESSHISTFILE=-
# }}}
# Section: Completion {{{
autoload -Uz compinit && compinit
export ZSH_CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/zsh"
mkdir -p "$ZSH_CACHE_DIR"
zstyle ':completion:*' cache-path "$ZSH_CACHE_DIR"

zstyle ':completion:*:rsync:*' remote-access yes
zstyle ':completion:*:rsync:*' tag-order hosts remote-directories files
# }}}
# Section: Executables {{{
# override macOS tools with GNU versions if available
alias awk="${HOMEBREW_PREFIX}/bin/gawk"
# if the names are the same, rely on the `$PATH` order
# alias ctags="${HOMEBREW_PREFIX}/bin/ctags"
# }}}

# Load additional zsh configs in this dir
# `(N)` is a zsh glob qualifier; bash uses `shopt -s nullglob`
for f in "$ZDOTDIR"/*.zsh(N); do
	. "$f"
done

# `https://www.chezmoi.io`
eval "$(chezmoi completion zsh)"

# eval "$(zoxide init zsh)"
eval "${$(zoxide init zsh):s#_files -/#_cd#}"
alias cd=z
alias zx='zoxide remove "$PWD" && echo "Removed $PWD from zoxide database."'

# `micromamba`
export MAMBA_EXE="$HOME/.local/bin/micromamba"
export MAMBA_ROOT_PREFIX="${XDG_CACHE_HOME:-$HOME/.cache}/micromamba"
eval "$("$MAMBA_EXE" shell hook -s zsh)"
# }}}

# FIXME: this doesn't belong here
micromamba activate cbmf 2>/dev/null || true
eval "$(register-python-argcomplete cbmf 2>/dev/null)" || true

# THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
# export SDKMAN_DIR="$HOME/.sdkman"
# [[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

# TeX Live 2025
export PATH="/usr/local/texlive/2025/bin/universal-darwin:$PATH"
export MANPATH="/usr/local/texlive/2025/texmf-dist/doc/man:$MANPATH"
export INFOPATH="/usr/local/texlive/2025/texmf-dist/doc/info:$INFOPATH"

# OSC 7 support for Neovim's built-in terminal
# Run this code only if NVIM is set (i.e., we're in Neovim)
if [[ -n $NVIM ]]; then
	echo "Setting up OSC 7 for Neovim terminal"
	typeset -ga precmd_functions
	print_osc7() {
		printf '\033]7;file://%s\033\\' "$PWD"
	}
	precmd_functions+=(print_osc7)
fi

eval $(thefuck --alias)

compdef _vim nv
echo "The computing scientist's main challenge is not to get confused by the complexities of his own making."
# vim:fdm=marker:fdl=0
