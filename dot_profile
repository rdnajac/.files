## ~/.profile
## POSIX-compliant profile script
## tested on bash, zsh, and dash

export MANPAGER="nvim +Man!"
export VISUAL=nvim

export MAMBA_EXE="$HOME/.local/bin/micromamba"
export MAMBA_ROOT_PREFIX="$HOME/.cache/micromamba"

# TeX Live 2025 
export PATH="/usr/local/texlive/2025/bin/universal-darwin:$PATH"
export MANPATH="/usr/local/texlive/2025/texmf-dist/doc/man:$MANPATH"
export INFOPATH="/usr/local/texlive/2025/texmf-dist/doc/info:$INFOPATH"

# correct, POSIX-compliant function definition
installed() { command -v "$1" > /dev/null 2>&1; }

# conditionally set alias based on available utilities
installed xdg-open && alias open='xdg-open > /dev/null 2>&1 &'

clipboard_err() {
	printf "\033[0;31mNo clipboard utility found\033[0m\n"
	exit 1
}

copy() {
	local file="${1:-/dev/stdin}"
	if installed pbcopy; then
		pbcopy < "$file"
	elif installed xclip; then
		xclip -sel clip < "$file"
	else
		printf "\033[0;31mNo clipboard utility found\033[0m\n"
		exit 1
	fi
	printf "\033[0;31mCopied contents of %s to clipboard\033[0m\n" "$file"
}

paste() {
	local file="${1:-/dev/stdout}"
	if installed pbpaste; then
		pbpaste > "$file"
	elif installed xclip; then
		xclip -sel clip -o > "$file"
	else
		printf "\033[0;31mNo clipboard utility found\033[0m\n"
		exit 1
	fi
	printf "\033[0;31mPasted contents of clipboard to %s\033[0m\n" "$file"
}

unset -f installed # clean-up

# Run this code only if NVIM is set (i.e., we're in Neovim)
if [ "$NVIM" != "" ]; then
	echo "Setting up OSC 7 for Neovim terminal"

	# shellcheck disable=SC3044
	typeset -ga precmd_functions
	print_osc7() {
		# shellcheck disable=SC1003
		printf '\033]7;file://%s\033\\' "$PWD"
	}
	# shellcheck disable=SC3044
	precmd_functions+=(print_osc7)

	nv() {
		nvim --server "$NVIM" --remote "$1"
	}
else

	alias nv=nvim
fi

printf "\033[32mThe computing scientist's main challenge is not to get confused by the complexities of his own making.\033[0m\n" >&2

# vim: ft=sh
