#!/bin/sh

# LOCAL_MOUNT_POINT=$RNVIM_COMPLDIR
# LOCAL_MOUNT_POINT=/Users/rdn/.remoteR
# REMOTE_CACHE_DIR=$RNVIM_REMOTE_COMPLDIR
REMOTE_CACHE_DIR=/home/ubuntu/.cache/R.nvim
REMOTE_LOGIN_HOST=RSS

# NVIM_IP_ADDRESS=$(hostname -I)
NVIM_IP_ADDRESS=$(ipconfig getifaddr en0)
# REMOTE_DIR_IS_MOUNTED=$(df | grep $LOCAL_MOUNT_POINT)

# if [ "x$REMOTE_DIR_IS_MOUNTED" = "x" ]; then
# 	echo "WARN: Remote directory '$REMOTE_CACHE_DIR' not mounted. Quit Neovim and start it again.\x14"
# 	sshfs $REMOTE_LOGIN_HOST:$REMOTE_CACHE_DIR $LOCAL_MOUNT_POINT
# 	sync
# 	exit 153
# fi

if [ "x$RNVIM_PORT" = "x" ]; then
	PSEUDOTERM='-T'
else
	PSEUDOTERM='-t'
fi

ssh $PSEUDOTERM $REMOTE_LOGIN_HOST \
	"RNVIM_TMPDIR=$REMOTE_CACHE_DIR/tmp \
		RNVIM_COMPLDIR=$REMOTE_CACHE_DIR \
		RNVIM_ID=$RNVIM_ID \
		RNVIM_SECRET=$RNVIM_SECRET \
		R_DEFAULT_PACKAGES=$R_DEFAULT_PACKAGES \
		NVIM_IP_ADDRESS=$NVIM_IP_ADDRESS \
		RNVIM_PORT=$RNVIM_PORT R $*"
